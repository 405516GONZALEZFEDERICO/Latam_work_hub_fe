<!-- Tarjeta de Completar Perfil -->
<div class="outer-container">
  <div class="profile-wrapper">
    <mat-card class="profile-card">
      <mat-card-content>
        <!-- Tabs -->
        <mat-tab-group mat-align-tabs="center" [(selectedIndex)]="activeTab" (selectedIndexChange)="setActiveTab($event)" animationDuration="0ms">
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="d-flex align-items-center">
                <mat-icon class="me-2">person</mat-icon>
                <span>Datos personales</span>
              </div>
            </ng-template>
            
            <div class="tab-content">
              <!-- Mostrar el stepper de dirección o formulario de datos personales -->
              <div *ngIf="!showAddressStepper">
                <app-personal-data-form
                  [initialData]="userData"
                  (formSubmitted)="handleFormSubmitted($event)">
                </app-personal-data-form>
                
                <!-- Sección de dirección con un botón para abrir el stepper -->
                <div class="address-section">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="address-title">Dirección</h3>
                    <button mat-stroked-button color="primary" (click)="toggleAddressStepper()">
                      <mat-icon>add</mat-icon> Agregar dirección
                    </button>
                  </div>
                  
                  <!-- Mostrar la dirección guardada si existe -->
                  <div *ngIf="addressData" class="address-card">
                    <div class="address-info">
                      <p><strong>{{addressData.city.country.name}}, {{addressData.city.name}}</strong></p>
                      <p>{{addressData.streetName}} {{addressData.streetNumber}}</p>
                      <p *ngIf="addressData.floor || addressData.apartment">
                        Piso: {{addressData.floor || '-'}}, Depto: {{addressData.apartment || '-'}}
                      </p>
                      <p>CP: {{addressData.postalCode}}</p>
                    </div>
                    <button mat-icon-button color="primary" (click)="toggleAddressStepper()">
                      <mat-icon>edit</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Stepper de dirección -->
              <div *ngIf="showAddressStepper">
                <div class="address-stepper-header">
                  <button mat-icon-button (click)="toggleAddressStepper()">
                    <mat-icon>arrow_back</mat-icon>
                  </button>
                  <h2>Dirección</h2>
                </div>
                <app-address-stepper 
                  [initialData]="addressData"
                  (addressSaved)="handleAddressSaved($event)">
                </app-address-stepper>
              </div>
            </div>
          </mat-tab>
          
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="d-flex align-items-center">
                <mat-icon class="me-2">business</mat-icon>
                <span>Tipo de Proveedor</span>
              </div>
            </ng-template>
            
            <div class="tab-content">
              <!-- Formulario de tipo de proveedor -->
              <div *ngIf="isProviderRole() && showProviderSelection">
                <app-provider-type-selection
                  [initialType]="providerType === 'INDIVIDUAL' ? 'individual' : providerType === 'COMPANY' ? 'company' : undefined"
                  [showBackButton]="showBackButton"
                  (typeSelected)="handleProviderTypeSelection($event)"
                  (saved)="handleProviderTypeSaved($event)"
                  (back)="backToProviderSelection()">
                </app-provider-type-selection>
              </div>
              
              <!-- Formulario de empresa -->
              <div *ngIf="isProviderRole() && providerType === 'COMPANY' && !showProviderSelection">
                <app-company-form
                  (back)="backToProviderSelection()">
                </app-company-form>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
</div>
